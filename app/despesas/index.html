<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Unikor – Despesas</title>
  <meta name="theme-color" content="#1e7f46" />
  <link rel="manifest" href="./manifest.json" />
  <link rel="stylesheet" href="./css/style.css" />
  <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
  <header class="topbar">
    <button id="btnVoltar" class="btn-back" title="Voltar">&larr;</button>
    <img class="logo" src="/assets/logo/unikorbranco-logo.svg" alt="UNIKOR" />
    <div style="margin-left:auto;text-align:right">
      <div class="title-strong">Despesas</div>
      <div id="usuarioLogado" class="user-mini">Usuário: —</div>
    </div>
  </header>

  <div class="wrap">
    <!-- Despesa Manual -->
    <div class="card">
      <h2>Despesa Manual</h2>

      <div class="row">
        <label>Categoria:</label>
        <input id="categoriaManual" list="listaCategorias" placeholder="Ex: Alimentação, Transporte" />
        <datalist id="listaCategorias"></datalist>
      </div>

      <div class="row">
        <label>Estabelecimento:</label>
        <input id="estabelecimento" placeholder="Nome do local da compra" />
      </div>

      <div class="row">
        <label>Forma de pagamento:</label>
        <select id="formaPagamento">
          <option value="DINHEIRO">Dinheiro</option>
          <option value="PIX">PIX</option>
          <option value="DEBITO">Débito</option>
          <option value="CREDITO">Crédito</option>
          <option value="BOLETO">Boleto</option>
          <option value="OUTROS">Outros</option>
        </select>
      </div>

      <div id="linhasProdutos"></div>

      <div class="actions-right">
        <button id="btnSalvarManual" class="btn primary">Salvar despesa manual</button>
      </div>
    </div>

    <!-- Foto + OCR -->
    <div class="card">
      <h2>Foto da Nota (OCR)</h2>

      <input type="file" id="fotoNota" accept="image/*" capture="environment" />
      <small class="muted">Dica: use boa iluminação. Se falhar, edite manualmente acima.</small>

      <div id="ocrPreviewWrap" class="ocr-preview-wrap hidden">
        <img id="ocrPreviewImg" alt="Pré-visualização da nota" class="img-preview" />
        <div class="grid2" style="margin-top:8px">
          <button id="btnOcrTrocar" class="btn outline">Trocar foto</button>
          <button id="btnOcrLimpar" class="btn">Limpar</button>
        </div>
      </div>

      <div class="actions-right">
        <button id="btnOcr" class="btn">Reconhecer (OCR)</button>
      </div>
    </div>

    <!-- NFC-e -->
    <div class="card">
      <h2>Capturar NFC-e (QR)</h2>

      <div class="row">
        <label>Categoria:</label>
        <input id="categoriaNfce" value="GERAL" />
      </div>

      <input id="qrUrl" placeholder="Cole a URL do QR da NFC-e" style="margin-bottom:8px" />

      <div class="grid2">
        <button id="btnProcessarNfce" class="btn">Processar URL</button>
        <button id="btnAbrirCamera" class="btn">Usar câmera</button>
      </div>

      <div class="scan-area">
        <video id="video" class="qr" autoplay playsinline style="background:#000;border-radius:10px"></video>
        <div class="grid2" style="margin-top:8px">
          <button id="btnFecharCamera" class="btn outline" disabled>Fechar câmera</button>
          <label class="btn outline" for="fotoNota" style="text-align:center">Foto da nota (fallback)</label>
        </div>
        <small class="muted">Câmera precisa de <b>HTTPS</b> (ou localhost). No iPhone PWA, prefira “Foto da nota”.</small>
      </div>

      <!-- Upload manual do PDF gerado na página oficial -->
      <input type="file" id="pdfNfce" accept="application/pdf" style="margin-top:8px" />
      <div class="actions-right">
        <button id="btnUploadPdfNfce" class="btn">Enviar PDF da página ao Drive</button>
      </div>
    </div>

    <!-- NFe-55 -->
    <div class="card">
      <h2>Enviar XML (NFe-55)</h2>
      <input type="file" id="xmlFile" accept=".xml" />
      <div class="grid2" style="margin-top:8px">
        <button id="btnProcessarNfe" class="btn" disabled>Processar XML (em breve)</button>
        <div></div>
      </div>
    </div>

    <div class="card">
      <h2>Status</h2>
      <pre id="statusBox">—</pre>
    </div>
  </div>

  <script type="module" src="./js/app.js"></script>
</body>
</html>