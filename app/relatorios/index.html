<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Unikor – Relatórios</title>
  <meta name="theme-color" content="#0ea5a6" />
  <base href="./">
  <link rel="icon" href="/assets/logo/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/logo/apple-touch-icon.png" />
  <link rel="stylesheet" href="./css/style.css" />
</head>
<body>
  <!-- Topo -->
  <header class="topbar">
    <div class="wrap">
      <a class="logo" href="/app/">
        <img src="/assets/logo/unikorbranco-logo.svg" alt="UNIKOR" />
      </a>
      <h1>Relatórios</h1>
      <div class="user">Usuário: <span id="userTag">—</span></div>
    </div>
  </header>

  <!-- ===== Modal de Edição de Pedido (único) ===== -->
  <div id="modalBackdrop" class="modal" aria-hidden="true">
    <div class="modal-backdrop"></div>

    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="mTitulo">
      <div class="modal-header">
        <h3 id="mTitulo">Editar Pedido</h3>
        <button id="btnFecharModal" class="modal-close" aria-label="Fechar">×</button>
      </div>

      <div class="modal-body">
        <div class="grid">
          <div>
            <label>ID do Pedido</label>
            <input id="mId" type="text" readonly />
          </div>
          <div>
            <label>Cliente</label>
            <input id="mCliente" type="text" />
          </div>
          <div>
            <label>Data Entrega (ISO)</label>
            <input id="mDataEntregaISO" type="date" />
          </div>
          <div>
            <label>Hora Entrega</label>
            <input id="mHoraEntrega" type="time" />
          </div>
          <div>
            <label>Tipo</label>
            <select id="mTipo">
              <option value="ENTREGA">ENTREGA</option>
              <option value="RETIRADA">RETIRADA</option>
            </select>
          </div>
          <div>
            <label>Pagamento</label>
            <input id="mPagamento" type="text" placeholder="ex.: PIX, DINHEIRO…" />
          </div>
          <div>
            <label>Nº do Cupom Fiscal</label>
            <input id="mCupomFiscal" type="text" />
          </div>
          <div>
            <label>Frete (R$)</label>
            <input id="mFrete" type="text" inputmode="decimal" placeholder="0,00" />
          </div>
          <div style="grid-column:1/-1">
            <label>Observações</label>
            <textarea id="mObs" rows="2"></textarea>
          </div>
        </div>

        <h4 style="margin:12px 0 8px">Itens</h4>
        <table class="items-table">
          <thead>
            <tr>
              <th>Descrição</th>
              <th>Qtd</th>
              <th>Un</th>
              <th>Preço</th>
              <th>Subtotal</th>
              <th class="right">Del.</th>
            </tr>
          </thead>
          <tbody id="itemsBody"></tbody>
        </table>

        <div class="grid" style="margin-top:10px">
          <div>
            <label>Total (itens)</label>
            <input id="mTotal" type="text" readonly />
          </div>
        </div>
      </div>

      <div class="modal-footer" style="display:flex; gap:10px; justify-content:flex-end; margin-top:12px">
        <button id="btnAddItem" class="btn btn-outline" type="button">Adicionar Item</button>
        <button id="btnPDFPedido" class="btn btn-gray" type="button" title="Reimprimir cupom">Gerar PDF</button>
        <button id="btnSalvar" class="btn btn-primary" type="button">Salvar</button>
      </div>
    </div>
  </div>
  <!-- ===== /Modal ===== -->

  <main class="container">
    <!-- Filtros -->
    <section class="card filters">
      <div class="grid">
        <div class="field" data-span="6">
          <label for="fDataIni">Data entrega — de</label>
          <input type="date" id="fDataIni" />
        </div>
        <div class="field" data-span="6">
          <label for="fDataFim">Data entrega — até</label>
          <input type="date" id="fDataFim" />
        </div>

        <div class="field" data-span="6">
          <label for="fHoraIni">Horário — de</label>
          <input type="time" id="fHoraIni" />
        </div>
        <div class="field" data-span="6">
          <label for="fHoraFim">Horário — até</label>
          <input type="time" id="fHoraFim" />
        </div>

        <div class="field" data-span="12">
          <label for="fCliente">Cliente (contém)</label>
          <input type="text" id="fCliente" placeholder="ex.: mercado" />
        </div>

        <div class="field" data-span="6">
          <label for="fTipo">Tipo (Entrega/Retirada)</label>
          <select id="fTipo">
            <option value="">Todos</option>
            <option value="ENTREGA">ENTREGA</option>
            <option value="RETIRADA">RETIRADA</option>
          </select>
        </div>

        <div class="field" data-span="6">
          <label for="fFormato">Formato</label>
          <select id="fFormato" disabled>
            <option>Reduzido</option>
          </select>
        </div>
      </div>

      <div class="actions">
        <button id="btnBuscar" class="btn btn-primary">Buscar</button>
        <button id="btnLimpar" class="btn btn-outline">Limpar</button>
        <button id="btnXLSX" class="btn btn-primary">Exportar XLSX</button>
        <button id="btnPDF"  class="btn btn-gray">Gerar PDF</button>
      </div>
    </section>

    <!-- Tabela -->
    <section class="card table-wrap">
      <div class="table-scroll">
        <table>
          <thead>
            <tr>
              <th>Data</th>
              <th>Hora</th>
              <th>Cliente <small>(clique para editar)</small></th>
              <th>Itens</th>
              <th>Total (R$)</th>
              <th>Tipo</th>
              <th>Pagamento</th>
              <th>Frete</th>
              <th>Nº Cupom</th>
              <th class="center">Imp.</th>
              <th class="center">Del.</th>
            </tr>
          </thead>
          <tbody id="tbody">
            <tr><td colspan="11" class="muted">Carregue um filtro…</td></tr>
          </tbody>
        </table>
      </div>

      <!-- Totais -->
      <div class="footer-totals">
        <div class="ft-box"><div class="ft-label">PEDIDOS</div><div id="ftCount">0</div></div>
        <div class="ft-box"><div class="ft-label">ITENS</div><div id="ftItens">0</div></div>
        <div class="ft-box"><div class="ft-label">TOTAL R$</div><div id="ftTotal">R$ 0,00</div></div>
        <div class="ft-box"><div class="ft-label">TOTAL FRETE</div><div id="ftFrete">R$ 0,00</div></div>
      </div>
    </section>
  </main>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- App JS -->
  <script type="module" src="./js/firebase.js"></script>
  <script type="module" src="./js/app.js"></script>
</body>
</html>