<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#1e7f46" />
  <title>Pedidos — UNIKOR V1.0.1</title>

  <link rel="manifest" href="./manifest.json" />
  <link rel="stylesheet" href="./css/style.css" />

  <!-- libs para exportar -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.19.3/dist/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <header class="topbar">
    <img src="./img/logo-unikor-white.svg" alt="UNIKOR" height="24" />
    <div class="grow"></div>
    <a class="link" href="../relatorios/">Relatórios</a>
  </header>

  <main class="container">
    <h1>Pedidos</h1>

    <!-- BLOCO: dados do cliente/entrega (mesmos campos do antigo) -->
    <section class="card grid grid-2">
      <div class="span-2">
        <label>Cliente</label>
        <input id="cCliente" placeholder="Nome do cliente" />
      </div>

      <div>
        <label>CNPJ</label>
        <input id="cCnpj" inputmode="numeric" placeholder="00.000.000/0000-00" />
        <small class="muted">Serão salvos apenas dígitos (validação leve).</small>
      </div>
      <div>
        <label>Inscrição Estadual</label>
        <input id="cIe" placeholder="Ex.: ISENTO ou número" />
        <small class="muted">Aceita “ISENTO”.</small>
      </div>

      <div class="span-2">
        <label>Endereço</label>
        <input id="cEndereco" placeholder="Rua, nº — bairro — cidade/UF" />
        <small class="muted">Se for outra cidade, inclua o <b>nome da cidade</b> ao final.</small>
      </div>

      <div>
        <label>Contato (tel/WhatsApp)</label>
        <input id="cContato" placeholder="(00) 00000-0000" />
      </div>
      <div>
        <label>CEP</label>
        <input id="cCep" inputmode="numeric" placeholder="00000-000" />
      </div>

      <div>
        <label>Data de entrega</label>
        <input id="cData" type="date" />
      </div>
      <div>
        <label>Hora de entrega</label>
        <input id="cHora" type="time" />
      </div>

      <div>
        <label>Entrega/Retirada</label>
        <select id="cTipo">
          <option value="ENTREGA">ENTREGA</option>
          <option value="RETIRADA">RETIRADA</option>
        </select>
      </div>
      <div>
        <label>Valor do frete (R$)</label>
        <input id="cFrete" class="right" placeholder="0,00" />
        <div class="row gap8 mt6">
          <label class="chk"><input id="cIsentarFrete" type="checkbox" /> Isentar frete</label>
          <button id="btnCalcularFrete" class="btn ghost sm">Calcular automaticamente</button>
        </div>
      </div>

      <div>
        <label>Forma de pagamento</label>
        <input id="cPagamento" placeholder="PIX / CRÉDITO / DINHEIRO..." />
      </div>
      <div>
        <label>Nº do cupom fiscal</label>
        <input id="cCupom" placeholder="ex.: 123456-1/001" />
      </div>

      <div class="span-2">
        <label>Observação geral</label>
        <input id="cObs" placeholder="(opcional)" />
      </div>
    </section>

    <!-- ITENS (mesma lógica do antigo) -->
    <section class="card">
      <div class="muted">Itens</div>
      <table class="items">
        <thead>
          <tr>
            <th style="width:36%">Produto/Descrição</th>
            <th style="width:12%">Tipo</th>
            <th style="width:12%">Quantidade</th>
            <th style="width:16%">Preço Unit. (R$)</th>
            <th style="width:16%">Subtotal</th>
            <th>Remover</th>
          </tr>
        </thead>
        <tbody id="itensBody"></tbody>
        <tfoot>
          <tr>
            <td colspan="6">
              <button class="btn ghost" id="btnAddItem">+ Adicionar Item</button>
            </td>
          </tr>
        </tfoot>
      </table>

      <div class="right mt8 totals">
        <div class="row gap12">
          <div><b>Itens:</b> <span id="lblTotItens">0</span></div>
          <div><b>Subtotal:</b> R$ <span id="lblSubtotal">0,00</span></div>
          <div><b>Frete:</b> R$ <span id="lblFrete">0,00</span></div>
          <div><b>Total:</b> R$ <span id="lblTotal">0,00</span></div>
        </div>
      </div>
    </section>

    <!-- AÇÕES -->
    <div class="actions">
      <button class="btn" id="btnSalvar"><span class="lbl">Salvar PDF</span></button>
      <button class="btn gray" id="btnCompartilhar"><span class="lbl">Compartilhar PDF</span></button>
    </div>
  </main>

  <!-- scripts do app -->
  <script type="module" src="../../js/guard.js"></script>
  <script type="module" src="./js/firebase.js"></script>
  <script type="module" src="./js/calcular-entrega.js"></script>
  <script type="module" src="./js/app.js"></script>

  <!-- SW local -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        try {
          const reg = await navigator.serviceWorker.register('./sw.js', { scope: './' });
          reg.addEventListener('updatefound', () => {
            const sw = reg.installing;
            sw && sw.addEventListener('statechange', () => {
              if (sw.state === 'installed' && navigator.serviceWorker.controller) reg.waiting?.postMessage('SKIP_WAITING');
            });
          });
          navigator.serviceWorker.addEventListener('controllerchange', () => location.reload());
        } catch (e) {}
      });
    }
  </script>
</body>
</html>